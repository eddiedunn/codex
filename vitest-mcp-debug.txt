
 RUN  v3.1.2 /Users/tmwsiy/code/codex

 ✓ codex-cli/tests/text-buffer.test.ts (14 tests) 30ms
 ✓ codex-cli/tests/text-buffer-gaps.test.ts (11 tests) 60ms
 ✓ codex-cli/tests/responses-chat-completions.test.ts (6 tests) 470ms
   ✓ responsesCreateViaChatCompletions > non-streaming mode > should convert basic user message to chat completions format  418ms
 ✓ codex-cli/tests/config.test.tsx (5 tests) 13ms
 ✓ codex-cli/tests/check-updates.test.ts (10 tests) 216ms
 ✓ codex-cli/tests/history-overlay.test.tsx (15 tests) 732ms
 ❯ codex-cli/tests/terminal-chat-input-multiline.test.tsx (3 tests | 2 failed) 596ms
   ✓ TerminalChatInput multiline functionality > renders the multiline editor component 207ms
   × TerminalChatInput multiline functionality > allows multiline input with shift+enter 93ms
     → expected '╭────────────────────────────────────…' to contain 'first line'
   × TerminalChatInput multiline functionality > allows multiline input with shift+enter (modifyOtherKeys=1 format) 127ms
     → expected '╭────────────────────────────────────…' to contain 'first line'
 ❯ codex-cli/tests/multiline-history-behavior.test.tsx (2 tests | 1 failed) 836ms
   ✓ TerminalChatInput – history navigation with multiline drafts > should not recall history until caret is on the first line  580ms
   × TerminalChatInput – history navigation with multiline drafts > should restore the draft when navigating forward (↓) past the newest history entry 246ms
     → expected false to be true // Object.is equality
 ✓ codex-cli/tests/clear-command.test.tsx (3 tests) 620ms
   ✓ /clear command > invokes clearTerminal and resets context in TerminalChatInput  513ms
 ✓ codex-cli/tests/text-buffer-word.test.ts (9 tests) 67ms
stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > navigates pages via keyboard
[PaginatedList] useInput received: n onQuit: [33mtrue[39m
[waitFor] Frame: "Page 2 not found"

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > navigates pages via keyboard
[PaginatedList] useInput received: p onQuit: [33mtrue[39m
[waitFor] Frame: "Page 1 not found after prev"

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > navigates pages via keyboard
[TEST] waiting for unmounted: [33mtrue[39m

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > shows correct quit behavior
[PaginatedList] useInput received: n onQuit: [33mtrue[39m
[waitFor] Frame: "Resource 3 not found"

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > shows correct quit behavior
[PaginatedList] useInput received: p onQuit: [33mtrue[39m
[waitFor] Frame: "Resource 1 not found after prev"

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > shows correct quit behavior
[PaginatedList] useInput received: n onQuit: [33mtrue[39m
[waitFor] Frame: "Resource 3 not found after next"

 ✓ src/cli/commands/resources/pagination.e2e.test.tsx (2 tests) 693ms
   ✓ ResourcesList Pagination E2E > navigates pages via keyboard  407ms
 ✓ codex-cli/tests/raw-exec-process-group.test.ts (1 test) 185ms
stdout | codex-cli/tests/multiline-dynamic-width.test.tsx > MultilineTextEditor – dynamic width > keeps the caret visible when the terminal width shrinks
FRAME AFTER RESIZE:
hijklmnopqrstuvwxyz

 ✓ codex-cli/tests/multiline-dynamic-width.test.tsx (1 test) 252ms
stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should connect and invoke the echo tool
[MCP CLIENT] Sending: {"jsonrpc":"2.0","id":95921612,"method":"tools/call","params":{"name":"echo","arguments":{"message":"hello MCP"}}}

 ✓ codex-cli/tests/package-manager-detector.test.ts (5 tests) 55ms
 ✓ codex-cli/tests/model-utils-network-error.test.ts (2 tests) 302ms
 ✓ codex-cli/tests/model-utils.test.ts (7 tests) 198ms
 ✓ codex-cli/tests/typeahead-scroll.test.tsx (1 test) 333ms
   ✓ TypeaheadOverlay – scrolling capability > passes the full item list to <SelectInput> so users can scroll beyond the visible limit  330ms
stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should connect and invoke the echo tool
[MCP CLIENT] Received: {"result":{"content":[{"type":"text","text":"Echo: hello MCP"}],"isError":false},"jsonrpc":"2.0","id":95921612}

stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should return error for unknown tool name
[MCP CLIENT] Sending: {"jsonrpc":"2.0","id":986361488,"method":"tools/call","params":{"name":"nonexistent_tool","arguments":{"foo":"bar"}}}

 ✓ codex-cli/tests/create-truncating-collector.test.ts (5 tests) 18ms
 ✓ codex-cli/tests/file-system-suggestions.test.ts (5 tests) 109ms
 ✓ codex-cli/tests/external-editor.test.ts (1 test) 53ms
 ✓ codex-cli/tests/project-doc.test.ts (3 tests) 57ms
stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should return error for unknown tool name
[MCP CLIENT] Received: {"jsonrpc":"2.0","id":986361488,"error":{"code":-32603,"message":"Tool not found: nonexistent_tool"}}

stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should return error for malformed arguments
[MCP CLIENT] Sending: {"jsonrpc":"2.0","id":271730920,"method":"tools/call","params":{"name":"echo","arguments":{"notMessage":123}}}

stdout | codex-cli/src/utils/agent/mcp-resource-integration.test.ts > MCP Resource Protocol (integration) > should list resources
[MCP CLIENT] Sending: {"jsonrpc":"2.0","id":485374658,"method":"resources/list","params":{}}

 ✓ codex-cli/tests/text-buffer-copy-paste.test.ts (2 tests) 8ms
 ✓ codex-cli/tests/cancel-exec.test.ts (2 tests) 781ms
   ✓ exec cancellation > allows the process to finish when not aborted  675ms
stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should return error for malformed arguments
[MCP CLIENT] Received: {"jsonrpc":"2.0","id":271730920,"error":{"code":-32603,"message":"Missing or invalid 'message' argument for echo tool"}}

stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should return error for invalid method
[MCP CLIENT] Sending: {"jsonrpc":"2.0","id":359573232,"method":"invalid/method","params":{"name":"echo","arguments":{"message":"test"}}}

stdout | codex-cli/tests/requires-shell.test.ts > requiresShell function > should detect pipe in a single argument
Parsing argument: "grep -n "finally:" some-file | head", tokens: [
  "grep",
  "-n",
  "finally:",
  "some-file",
  {
    "op": "|"
  },
  "head"
]

stdout | codex-cli/tests/requires-shell.test.ts > requiresShell function > should not detect pipe in separate arguments
Parsing argument: "grep", tokens: [
  "grep"
]
Parsing argument: "-n", tokens: [
  "-n"
]
Parsing argument: "finally:", tokens: [
  "finally:"
]
Parsing argument: "some-file", tokens: [
  "some-file"
]
Parsing argument: "|", tokens: [
  {
    "op": "|"
  }
]
Parsing argument: "head", tokens: [
  "head"
]
Result for separate arguments: false
Result for separate arguments: [33mfalse[39m

stdout | codex-cli/tests/requires-shell.test.ts > requiresShell function > should handle other shell operators
Parsing argument: "echo hello && echo world", tokens: [
  "echo",
  "hello",
  {
    "op": "&&"
  },
  "echo",
  "world"
]

 ✓ codex-cli/tests/requires-shell.test.ts (3 tests) 31ms
 ✓ codex-cli/tests/multiline-external-editor-shortcut.test.tsx (2 tests) 171ms
stdout | codex-cli/tests/multiline-newline.test.tsx > MultilineTextEditor – inserting new lines > splits the line and renders the new row when <Enter> is pressed

--- RENDERED FRAME ---
hello
world
---------------------

 ✓ codex-cli/tests/multiline-newline.test.tsx (1 test) 319ms
   ✓ MultilineTextEditor – inserting new lines > splits the line and renders the new row when <Enter> is pressed  317ms
 ✓ codex-cli/tests/terminal-chat-completions.test.tsx (3 tests) 268ms
 ✓ codex-cli/tests/input-utils.test.ts (3 tests) 130ms
 ✓ codex-cli/tests/slash-commands.test.ts (2 tests) 126ms
stdout | codex-cli/src/utils/agent/mcp-stdio-integration.test.ts > MCP stdio integration (reference server) > should return error for invalid method
[MCP CLIENT] Received: {"jsonrpc":"2.0","id":359573232,"error":{"code":-32601,"message":"Method not found"}}

 ✓ codex-cli/src/utils/agent/mcp-stdio-integration.test.ts (5 tests | 1 skipped) 4727ms
   ✓ MCP stdio integration (reference server) > should connect and invoke the echo tool  1074ms
   ✓ MCP stdio integration (reference server) > should return error for unknown tool name  824ms
   ✓ MCP stdio integration (reference server) > should return error for malformed arguments  947ms
   ✓ MCP stdio integration (reference server) > should return error for invalid method  861ms
 ✓ codex-cli/tests/fixed-requires-shell.test.ts (4 tests) 9ms
 ✓ codex-cli/tests/multiline-shift-enter-crlf.test.tsx (1 test) 250ms
 ✓ codex-cli/tests/parse-apply-patch.test.ts (2 tests) 11ms
 ✓ codex-cli/src/utils/agent/mcp-servers-config.test.ts (3 tests) 10ms
 ✓ codex-cli/src/utils/agent/mcp-client.test.ts (3 tests) 17ms
 ✓ codex-cli/tests/api-key.test.ts (1 test) 33ms
 ✓ codex-cli/tests/multiline-shift-enter-mod1.test.tsx (1 test) 443ms
   ✓ MultilineTextEditor – Shift+Enter with modifyOtherKeys=1 > inserts newline, does NOT submit  441ms
 ✓ codex-cli/tests/multiline-shift-enter.test.tsx (1 test) 194ms
 ✓ codex-cli/tests/format-command.test.ts (3 tests) 10ms
 ✓ codex-cli/tests/model-info.test.ts (2 tests) 24ms
 ✓ codex-cli/tests/multiline-ctrl-enter-submit.test.tsx (1 test) 353ms
   ✓ MultilineTextEditor – Ctrl+Enter submits > calls onSubmit when CSI 13;5u is received  350ms
stdout | codex-cli/tests/pipe-command.test.ts > shell-quote parse with pipes > should correctly parse a command with a pipe
Parsed tokens: [
  "grep",
  "-n",
  "finally:",
  "some-file",
  {
    "op": "|"
  },
  "head"
]

 ✓ codex-cli/tests/pipe-command.test.ts (1 test) 9ms
 ✓ codex-cli/tests/text-buffer-crlf.test.ts (1 test) 9ms
 ✓ codex-cli/tests/terminal-chat-input-compact.test.tsx (1 test) 320ms
   ✓ TerminalChatInput compact command > shows /compact hint when context is low  317ms
 ✓ codex-cli/tests/dummy.test.ts (1 test) 5ms
 ✓ codex-cli/tests/multiline-enter-submit-cr.test.tsx (1 test) 266ms
stdout | codex-cli/src/utils/agent/mcp-resource-integration.test.ts > MCP Resource Protocol (integration) > should read a resource
[MCP CLIENT] Sending: {"jsonrpc":"2.0","id":450990075,"method":"resources/list","params":{}}

 ❯ src/cli/commands/resources/integration.test.ts (1 test | 1 skipped) 10177ms
   ↓ MCP CLI integration > lists resources with pagination
stdout | codex-cli/src/utils/agent/mcp-resource-integration.test.ts > MCP Resource Protocol (integration)
[MCP CLIENT] Disconnecting MCP process...

 ❯ codex-cli/src/utils/agent/mcp-resource-integration.test.ts (3 tests | 2 failed) 10062ms
   × MCP Resource Protocol (integration) > should list resources 5015ms
     → Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   × MCP Resource Protocol (integration) > should read a resource 5008ms
     → Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   ✓ MCP Resource Protocol (unit, mock) > should parse resource list from mock server 3ms
