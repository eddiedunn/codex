
 RUN  v3.1.2 /Users/tmwsiy/code/codex

 ✓ codex-cli/tests/text-buffer.test.ts (14 tests) 16ms
 ✓ codex-cli/tests/text-buffer-gaps.test.ts (11 tests) 47ms
 ✓ codex-cli/tests/responses-chat-completions.test.ts (6 tests) 604ms
   ✓ responsesCreateViaChatCompletions > non-streaming mode > should convert basic user message to chat completions format  533ms
 ✓ codex-cli/tests/config.test.tsx (5 tests) 20ms
 ✓ codex-cli/tests/check-updates.test.ts (10 tests) 128ms
 ✓ codex-cli/tests/history-overlay.test.tsx (15 tests) 775ms
 ❯ codex-cli/tests/terminal-chat-input-multiline.test.tsx (3 tests | 2 failed) 794ms
   ✓ TerminalChatInput multiline functionality > renders the multiline editor component 284ms
   × TerminalChatInput multiline functionality > allows multiline input with shift+enter 246ms
     → expected '╭────────────────────────────────────…' to contain 'first line'
   × TerminalChatInput multiline functionality > allows multiline input with shift+enter (modifyOtherKeys=1 format) 227ms
     → expected '╭────────────────────────────────────…' to contain 'first line'
 ❯ codex-cli/tests/multiline-history-behavior.test.tsx (2 tests | 1 failed) 889ms
   ✓ TerminalChatInput – history navigation with multiline drafts > should not recall history until caret is on the first line  562ms
   × TerminalChatInput – history navigation with multiline drafts > should restore the draft when navigating forward (↓) past the newest history entry 325ms
     → expected false to be true // Object.is equality
 ✓ codex-cli/tests/clear-command.test.tsx (3 tests) 689ms
   ✓ /clear command > invokes clearTerminal and resets context in TerminalChatInput  642ms
 ✓ codex-cli/tests/text-buffer-word.test.ts (9 tests) 13ms
stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > navigates pages via keyboard
[PaginatedList] useInput received: n onQuit: [33mtrue[39m
[waitFor] Frame: "Page 2 not found"

 ✓ codex-cli/tests/raw-exec-process-group.test.ts (1 test) 297ms
stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > navigates pages via keyboard
[PaginatedList] useInput received: p onQuit: [33mtrue[39m
[waitFor] Frame: "Page 1 not found after prev"

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > navigates pages via keyboard
[TEST] waiting for unmounted: [33mtrue[39m

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > shows correct quit behavior
[PaginatedList] useInput received: n onQuit: [33mtrue[39m
[waitFor] Frame: "Resource 3 not found"

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > shows correct quit behavior
[PaginatedList] useInput received: p onQuit: [33mtrue[39m
[waitFor] Frame: "Resource 1 not found after prev"

stdout | src/cli/commands/resources/pagination.e2e.test.tsx > ResourcesList Pagination E2E > shows correct quit behavior
[PaginatedList] useInput received: n onQuit: [33mtrue[39m
[waitFor] Frame: "Resource 3 not found after next"

 ✓ src/cli/commands/resources/pagination.e2e.test.tsx (2 tests) 682ms
   ✓ ResourcesList Pagination E2E > navigates pages via keyboard  478ms
stdout | codex-cli/tests/multiline-dynamic-width.test.tsx > MultilineTextEditor – dynamic width > keeps the caret visible when the terminal width shrinks
FRAME AFTER RESIZE:
hijklmnopqrstuvwxyz

 ✓ codex-cli/tests/multiline-dynamic-width.test.tsx (1 test) 547ms
   ✓ MultilineTextEditor – dynamic width > keeps the caret visible when the terminal width shrinks  544ms
 ✓ codex-cli/tests/package-manager-detector.test.ts (5 tests) 11ms
 ✓ codex-cli/tests/model-utils.test.ts (7 tests) 140ms
 ✓ codex-cli/tests/model-utils-network-error.test.ts (2 tests) 320ms
 ❯ codex-cli/src/utils/agent/mcp-stdio-integration.test.ts (4 tests | 4 failed) 1043ms
   × MCP stdio integration (mcptools mock) > should connect and invoke the echo tool 11ms
     → Missing stdioPath for MCP stdio transport
   × MCP stdio integration (mcptools mock) > should return error for unknown tool name 1ms
     → Missing stdioPath for MCP stdio transport
   × MCP stdio integration (mcptools mock) > should return error for malformed arguments 1ms
     → Missing stdioPath for MCP stdio transport
   × MCP stdio integration (mcptools mock) > should return error for invalid method 1ms
     → Missing stdioPath for MCP stdio transport
 ✓ codex-cli/tests/typeahead-scroll.test.tsx (1 test) 300ms
 ✓ codex-cli/tests/create-truncating-collector.test.ts (5 tests) 17ms
 ✓ codex-cli/tests/file-system-suggestions.test.ts (5 tests) 97ms
 ✓ codex-cli/tests/external-editor.test.ts (1 test) 72ms
 ✓ codex-cli/tests/project-doc.test.ts (3 tests) 77ms
 ❯ codex-cli/src/utils/agent/mcp-resource-integration.test.ts (3 tests | 2 skipped) 1225ms
   ↓ MCP Resource Protocol (integration, mcptools mock) > should list resources
   ↓ MCP Resource Protocol (integration, mcptools mock) > should read a resource
   ✓ MCP Resource Protocol (unit, mock) > should parse resource list from mock server 3ms
 ✓ codex-cli/tests/text-buffer-copy-paste.test.ts (2 tests) 8ms
stdout | codex-cli/tests/requires-shell.test.ts > requiresShell function > should detect pipe in a single argument
Parsing argument: "grep -n "finally:" some-file | head", tokens: [
  "grep",
  "-n",
  "finally:",
  "some-file",
  {
    "op": "|"
  },
  "head"
]

stdout | codex-cli/tests/requires-shell.test.ts > requiresShell function > should not detect pipe in separate arguments
Parsing argument: "grep", tokens: [
  "grep"
]
Parsing argument: "-n", tokens: [
  "-n"
]
Parsing argument: "finally:", tokens: [
  "finally:"
]
Parsing argument: "some-file", tokens: [
  "some-file"
]
Parsing argument: "|", tokens: [
  {
    "op": "|"
  }
]
Parsing argument: "head", tokens: [
  "head"
]
Result for separate arguments: false
Result for separate arguments: [33mfalse[39m

stdout | codex-cli/tests/requires-shell.test.ts > requiresShell function > should handle other shell operators
Parsing argument: "echo hello && echo world", tokens: [
  "echo",
  "hello",
  {
    "op": "&&"
  },
  "echo",
  "world"
]

 ✓ codex-cli/tests/requires-shell.test.ts (3 tests) 15ms
 ✓ codex-cli/tests/cancel-exec.test.ts (2 tests) 577ms
   ✓ exec cancellation > allows the process to finish when not aborted  550ms
 ✓ codex-cli/tests/input-utils.test.ts (3 tests) 128ms
 ✓ codex-cli/tests/multiline-external-editor-shortcut.test.tsx (2 tests) 323ms
   ✓ MultilineTextEditor – external editor shortcut > fires openInExternalEditor on Ctrl‑E (single key)  308ms
stdout | codex-cli/tests/multiline-newline.test.tsx > MultilineTextEditor – inserting new lines > splits the line and renders the new row when <Enter> is pressed

--- RENDERED FRAME ---
hello
world
---------------------

 ✓ codex-cli/tests/multiline-newline.test.tsx (1 test) 547ms
   ✓ MultilineTextEditor – inserting new lines > splits the line and renders the new row when <Enter> is pressed  544ms
 ✓ codex-cli/tests/terminal-chat-completions.test.tsx (3 tests) 335ms
 ✓ codex-cli/tests/slash-commands.test.ts (2 tests) 12ms
 ✓ codex-cli/tests/fixed-requires-shell.test.ts (4 tests) 87ms
 ✓ codex-cli/tests/parse-apply-patch.test.ts (2 tests) 14ms
 ✓ codex-cli/src/utils/agent/mcp-servers-config.test.ts (3 tests) 30ms
 ✓ codex-cli/tests/multiline-shift-enter-crlf.test.tsx (1 test) 311ms
   ✓ MultilineTextEditor – Shift+Enter ( variant) > inserts a newline and does NOT submit when the terminal sends  for Shift+Enter  309ms
 ✓ codex-cli/tests/multiline-shift-enter-mod1.test.tsx (1 test) 246ms
 ✓ codex-cli/src/utils/agent/mcp-client.test.ts (3 tests) 89ms
 ✓ codex-cli/tests/multiline-shift-enter.test.tsx (1 test) 317ms
   ✓ MultilineTextEditor – Shift+Enter > inserts a newline instead of submitting  314ms
 ✓ codex-cli/tests/api-key.test.ts (1 test) 37ms
 ✓ codex-cli/tests/format-command.test.ts (3 tests) 19ms
 ✓ codex-cli/tests/model-info.test.ts (2 tests) 19ms
 ✓ codex-cli/tests/text-buffer-crlf.test.ts (1 test) 7ms
stdout | codex-cli/tests/pipe-command.test.ts > shell-quote parse with pipes > should correctly parse a command with a pipe
Parsed tokens: [
  "grep",
  "-n",
  "finally:",
  "some-file",
  {
    "op": "|"
  },
  "head"
]

 ✓ codex-cli/tests/pipe-command.test.ts (1 test) 10ms
 ✓ codex-cli/tests/multiline-ctrl-enter-submit.test.tsx (1 test) 355ms
   ✓ MultilineTextEditor – Ctrl+Enter submits > calls onSubmit when CSI 13;5u is received  353ms
 ✓ codex-cli/tests/dummy.test.ts (1 test) 6ms
 ✓ codex-cli/tests/multiline-enter-submit-cr.test.tsx (1 test) 172ms
 ✓ codex-cli/tests/terminal-chat-input-compact.test.tsx (1 test) 241ms
 ❯ src/cli/commands/resources/integration.test.ts (1 test | 1 skipped) 10122ms
   ↓ MCP CLI integration > lists resources with pagination
